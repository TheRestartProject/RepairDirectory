#!/usr/bin/env bash
case "$1" in
    'documentation')
        docker/bin/phpdoc -d src -d app -t reports/docs
        ;;

    'code')
        docker/bin/composer run-script code
        ;;
    'sniff')
        docker/bin/composer run-script sniff
        ;;
    'mess')
        docker/bin/composer run-script mess
        ;;
    'duplication')
        docker/bin/composer run-script copypaste
        ;;
    'stan')
        docker/bin/composer run-script stan
        ;;

    'coverage')
        cd docker
        docker-compose -f docker-compose.yml -f docker-compose.testing.yml up -d database_testing
        docker-compose -f docker-compose.yml -f docker-compose.testing.yml run --rm xdebug php vendor/bin/phpunit --testsuite=Unit --testsuite=Feature --coverage-html reports/codecoverage
        docker-compose -f docker-compose.yml -f docker-compose.testing.yml stop database_testing
        cd ..
        ;;
    'unit')
        cd docker
        docker-compose -f docker-compose.yml -f docker-compose.testing.yml run --rm php php vendor/bin/phpunit --testsuite=Unit
        cd ..
        ;;
    'feature')
        cd docker
        docker-compose -f docker-compose.yml -f docker-compose.testing.yml up -d database_testing
        docker-compose -f docker-compose.yml -f docker-compose.testing.yml run --rm php php vendor/bin/phpunit --testsuite=Feature
        docker-compose -f docker-compose.yml -f docker-compose.testing.yml stop database_testing
        cd ..
        ;;
    'browser')
        cd docker
        docker-compose -f docker-compose.yml -f docker-compose.testing.yml up -d restart-project.local database_testing
        docker-compose -f docker-compose.yml -f docker-compose.testing.yml run --rm  dusk
        docker-compose -f docker-compose.yml -f docker-compose.testing.yml stop selenium
        docker-compose -f docker-compose.yml up -d restart-project.local
        cd ..
        ;;
    *)
        echo $"Usage: $0 {documentation|code|sniff|mess|duplication|stan|unit|feature|browser}"
        ;;
esac
